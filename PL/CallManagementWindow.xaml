<Window x:Class="PL.Manager.CallManagementWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:PL.Manager"
        Title="ניהול קריאות"
        Height="600" Width="1000"
        WindowStartupLocation="CenterScreen"
        Loaded="Window_Loaded"
        Closed="Window_Closed">

    <DockPanel Margin="10">
        <StackPanel Orientation="Horizontal" DockPanel.Dock="Top" Margin="0,0,0,10">
            <ComboBox Width="150" Margin="0,0,10,0"
                      ItemsSource="{Binding Statuses}"
                      SelectedItem="{Binding SelectedStatus}"/>
            <Button Content="סינון" Width="100" Click="Filter_Click"/>
            <Button Content="ביטול סינון" Width="100" Click="CancelFilter_Click"/>
            <Button Content="הוספת קריאה" Width="120" Margin="10,0,0,0" Click="AddCall_Click"/>
        </StackPanel>

        <DataGrid ItemsSource="{Binding Calls}" AutoGenerateColumns="False"
                  CanUserAddRows="False" IsReadOnly="True"
                  MouseDoubleClick="DataGrid_MouseDoubleClick">

            <DataGrid.Columns>
                <DataGridTextColumn Header="מזהה" Binding="{Binding CallId}"/>
                <DataGridTextColumn Header="סטטוס" Binding="{Binding Status}"/>
                <DataGridTextColumn Header="זמן נותר" Binding="{Binding RemainingTime}"/>
                <DataGridTextColumn Header="משך טיפול" Binding="{Binding TotalTreatmentTime}"/>
                <DataGridTextColumn Header="מתנדב אחרון" Binding="{Binding LastVolunteerName}"/>
                <DataGridTextColumn Header="סה״כ הקצאות" Binding="{Binding SumOfAssignments}"/>

                <DataGridTemplateColumn Header="מחיקה">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Button Content="🗑" 
                                    Click="DeleteCall_Click"
                                    CommandParameter="{Binding}"
                                    Visibility="{Binding CanDelete, Converter={StaticResource BoolToVisibilityConverter}}"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <DataGridTemplateColumn Header="ביטול" Width="80">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Button Content="❌"
                                    ToolTip="בטל הקצאה"
                                    FontWeight="Bold"
                                    FontSize="16"
                                    Cursor="Hand"
                                    Background="Transparent"
                                    BorderBrush="Transparent"
                                    Foreground="Red"
                                    Click="CancelAssignment_Click"
                                    CommandParameter="{Binding}"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

            </DataGrid.Columns>
        </DataGrid>
    </DockPanel>
</Window>
